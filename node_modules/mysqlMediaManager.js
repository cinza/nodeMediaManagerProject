/* MySQL connection module */

var mysql = require('mysql');
var pool;
var credentials = {};

if (process.env.VCAP_SERVICES) {
  var configuration = JSON.parse(process.env.VCAP_SERVICES);
  credentials = configuration['mysql-5.1'][0]['credentials'];
}else{
  console.log('No database envioroment variable found, using local setings intead.');
  
  credentials.name = 'd8e11dba65bf74a4d8cb9a5552aaab2dd'
  credentials.host = 'localhost';

  //Server
  // credentials.port = '10000';
  // credentials.user = 'uVgR0JG9NfQK5';
  // credentials.password = 'pa1DbbVuAx9Cd';

  //Eduardo
  credentials.port = '3306';
  credentials.user = 'uVgR0JG9NfQK5';
  credentials.password = 'pa1DbbVuAx9Cd';

  
  //Andrea
  // credentials.port = '3306';
  // credentials.user = 'root';
  // credentials.password = 'admin123';

};

pool = mysql.createPool({
  database        : credentials.name,
  host            : credentials.host,
  port            : credentials.port,
  user            : credentials.user,
  password        : credentials.password,
  connectionLimit : 1
});

var createMediaManagerTestData = function(test, next){
  pool.getConnection(function(err, connection){
    var query = 'call createMediaManagerTestData("'+ test +'")';
    connection.query(query, function(err) {    
      if (err) {
        console.log('Error executing stored procedure createMediaManagerTestData.');
        console.log(err);
      };
      next(err);
      connection.release();
    });
  });
};


exports.pool = pool;
exports.createMediaManagerTestData = createMediaManagerTestData;
